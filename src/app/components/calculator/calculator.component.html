<div class="calculator-container">
  <h2>Calculadora Alfa vs √îmega Strike</h2>

  <!-- Server Log Section -->
  <div class="server-log-section">
    <button class="toggle-btn" (click)="toggleServerLog()">
      {{ showServerLog ? "‚ñº" : "‚ñ∂" }} Analisar Server Log do Tibia
    </button>

    <div class="server-log-content" *ngIf="showServerLog">
      <p class="info-text">
        Cole aqui o server log do Tibia. O sistema vai identificar
        automaticamente seus danos e calcular a m√©dia,
        <strong>excluindo danos de charms</strong>.
      </p>

      <textarea
        [(ngModel)]="serverLog"
        (ngModelChange)="parseServerLog()"
        placeholder="Cole aqui seu server log do Tibia...
Exemplo:
14:37:27 A destroyer loses 340 hitpoints due to your attack.
14:37:27 A dark torturer loses 397 hitpoints due to your attack. (freeze charm)
14:37:27 A dark torturer loses 414 hitpoints due to your attack."
        rows="10"
        class="server-log-textarea"
      >
      </textarea>

      <div class="server-log-actions">
        <button class="btn-secondary" (click)="clearServerLog()">Limpar</button>
        <button
          class="btn-primary"
          (click)="useAverageDamage()"
          [disabled]="!parsedStats || parsedStats.average === 0"
        >
          Usar M√©dia Calculada
        </button>
      </div>

      <div class="stats-display" *ngIf="parsedStats && parsedStats.count > 0">
        <h4>üìä Estat√≠sticas do Server Log</h4>
        <div class="stats-grid">
          <div class="stat-item">
            <span class="stat-label">M√©dia de Dano:</span>
            <span class="stat-value highlight">{{ parsedStats.average }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Total de Hits:</span>
            <span class="stat-value">{{ parsedStats.count }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Dano M√≠nimo:</span>
            <span class="stat-value">{{ parsedStats.min }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Dano M√°ximo:</span>
            <span class="stat-value">{{ parsedStats.max }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Mediana:</span>
            <span class="stat-value">{{ parsedStats.median }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Critical Hits:</span>
            <span class="stat-value">{{ parsedStats.criticalHits }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Hits Normais:</span>
            <span class="stat-value">{{ parsedStats.normalHits }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Charms Exclu√≠dos:</span>
            <span class="stat-value excluded">{{ parsedStats.excluded }}</span>
          </div>
        </div>
      </div>

      <div
        class="stats-display warning"
        *ngIf="
          parsedStats && parsedStats.count === 0 && serverLog.trim() !== ''
        "
      >
        <p>
          ‚ö†Ô∏è Nenhum dano encontrado no server log. Verifique se o formato est√°
          correto.
        </p>
      </div>
    </div>
  </div>

  <div class="inputs-section">
    <div class="input-group">
      <label for="baseDamage">Dano M√©dio do Personagem:</label>
      <input
        type="number"
        id="baseDamage"
        [(ngModel)]="baseDamage"
        (ngModelChange)="onInputChange()"
        min="1"
        step="100"
      />
    </div>

    <div class="input-group">
      <label for="monsterHp">HP do Monstro:</label>
      <input
        type="number"
        id="monsterHp"
        [(ngModel)]="monsterHp"
        (ngModelChange)="onInputChange()"
        min="1"
        step="500"
      />
    </div>

    <div class="input-group">
      <label for="alfaBonus">B√¥nus Alfa (%):</label>
      <input
        type="number"
        id="alfaBonus"
        [(ngModel)]="alfaBonus"
        (ngModelChange)="onInputChange()"
        min="0"
        step="0.5"
      />
    </div>

    <div class="input-group">
      <label for="omegaBonus">B√¥nus √îmega (%):</label>
      <input
        type="number"
        id="omegaBonus"
        [(ngModel)]="omegaBonus"
        (ngModelChange)="onInputChange()"
        min="0"
        step="0.5"
      />
    </div>
  </div>

  <div
    class="recommendation-section"
    [ngClass]="{
      omega: recommendation.includes('√îMEGA'),
      alfa: recommendation.includes('ALFA'),
      empate: recommendation.includes('EMPATE')
    }"
  >
    <div class="icon-frame" *ngIf="recommendation.includes('ALFA')">
      <img
        src="assets/images/Proficiency_Type_Alpha_Dmg.gif"
        alt="Alfa Strike Recomendado"
        class="recommendation-icon"
      />
    </div>
    <div class="icon-frame" *ngIf="recommendation.includes('√îMEGA')">
      <img
        src="assets/images/Proficiency_Type_Omega_Dmg.gif"
        alt="√îmega Strike Recomendado"
        class="recommendation-icon"
      />
    </div>
    <div class="recommendation-content">
      <h3>Recomenda√ß√£o:</h3>
      <p class="recommendation-text">{{ recommendation }}</p>
    </div>
  </div>

  <div class="details-section">
    <div class="result-card alfa-card">
      <div class="card-header">
        <div class="icon-frame">
          <img
            src="assets/images/Proficiency_Type_Alpha_Dmg.gif"
            alt="Alfa Strike"
            class="card-icon"
          />
        </div>
        <h4>Alfa Strike ({{ alfaBonus }}% quando HP > 95%)</h4>
      </div>
      <div class="stats" *ngIf="alfaResult">
        <p>
          <strong>Dano Total:</strong> {{ alfaResult.totalDamage.toFixed(0) }}
        </p>
        <p>
          <strong>Dano com B√¥nus:</strong>
          {{ alfaResult.bonusDamage.toFixed(0) }}
        </p>
      </div>
    </div>

    <div class="result-card omega-card">
      <div class="card-header">
        <div class="icon-frame">
          <img
            src="assets/images/Proficiency_Type_Omega_Dmg.gif"
            alt="√îmega Strike"
            class="card-icon"
          />
        </div>
        <h4>√îmega Strike ({{ omegaBonus }}% quando HP < 30%)</h4>
      </div>
      <div class="stats" *ngIf="omegaResult">
        <p>
          <strong>Dano Total:</strong> {{ omegaResult.totalDamage.toFixed(0) }}
        </p>
        <p>
          <strong>Dano com B√¥nus:</strong>
          {{ omegaResult.bonusDamage.toFixed(0) }}
        </p>
      </div>
    </div>
  </div>
</div>
