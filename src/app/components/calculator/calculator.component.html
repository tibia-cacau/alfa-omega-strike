<div class="calculator-container">
  <h2>Calculadora Alfa vs √îmega Strike</h2>

  <!-- Server Log Section -->
  <div class="server-log-section">
    <button class="toggle-btn" (click)="toggleServerLog()">
      {{ showServerLog ? "‚ñº" : "‚ñ∂" }} Analisar Server Log do Tibia
    </button>

    <div class="server-log-content" *ngIf="showServerLog">
      <p class="info-text">
        Cole aqui o server log do Tibia. O sistema vai identificar
        automaticamente seus danos e calcular a m√©dia,
        <strong>excluindo danos de charms</strong>.
      </p>

      <textarea
        [(ngModel)]="serverLog"
        (ngModelChange)="parseServerLog()"
        placeholder="Cole aqui seu server log do Tibia...
Exemplo:
14:37:27 A destroyer loses 340 hitpoints due to your attack.
14:37:27 A dark torturer loses 397 hitpoints due to your attack. (freeze charm)
14:37:27 A dark torturer loses 414 hitpoints due to your attack."
        rows="10"
        class="server-log-textarea"
      >
      </textarea>

      <div class="server-log-actions">
        <button class="btn-secondary" (click)="clearServerLog()">Limpar</button>
        <button
          class="btn-primary"
          (click)="useAverageDamage()"
          [disabled]="!parsedStats || parsedStats.average === 0"
        >
          Usar M√©dia Calculada
        </button>
      </div>

      <div class="stats-display" *ngIf="parsedStats && parsedStats.count > 0">
        <h4>üìä Estat√≠sticas do Server Log</h4>
        <div class="stats-grid">
          <div class="stat-item">
            <span class="stat-label">M√©dia de Dano:</span>
            <span class="stat-value highlight">{{ parsedStats.average }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Total de Hits:</span>
            <span class="stat-value">{{ parsedStats.count }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Dano M√≠nimo:</span>
            <span class="stat-value">{{ parsedStats.min }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Dano M√°ximo:</span>
            <span class="stat-value">{{ parsedStats.max }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Mediana:</span>
            <span class="stat-value">{{ parsedStats.median }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Critical Hits:</span>
            <span class="stat-value">{{ parsedStats.criticalHits }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Hits Normais:</span>
            <span class="stat-value">{{ parsedStats.normalHits }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Charms Exclu√≠dos:</span>
            <span class="stat-value excluded">{{ parsedStats.excluded }}</span>
          </div>
        </div>
      </div>

      <div
        class="stats-display warning"
        *ngIf="
          parsedStats && parsedStats.count === 0 && serverLog.trim() !== ''
        "
      >
        <p>
          ‚ö†Ô∏è Nenhum dano encontrado no server log. Verifique se o formato est√°
          correto.
        </p>
      </div>
    </div>
  </div>

  <div class="inputs-section">
    <div class="input-group">
      <label for="baseDamage">Dano M√©dio do Personagem:</label>
      <input
        type="number"
        id="baseDamage"
        [(ngModel)]="baseDamage"
        (ngModelChange)="onInputChange()"
        min="1"
        step="100"
      />
    </div>

    <div class="input-group">
      <label for="monsterHp">HP do Monstro:</label>
      <input
        type="number"
        id="monsterHp"
        [(ngModel)]="monsterHp"
        (ngModelChange)="onInputChange()"
        min="1"
        step="500"
      />
    </div>

    <div class="input-group">
      <label for="alfaBonus">B√¥nus Alfa (%):</label>
      <input
        type="number"
        id="alfaBonus"
        [(ngModel)]="alfaBonus"
        (ngModelChange)="onInputChange()"
        min="0"
        step="0.5"
      />
    </div>

    <div class="input-group">
      <label for="omegaBonus">B√¥nus √îmega (%):</label>
      <input
        type="number"
        id="omegaBonus"
        [(ngModel)]="omegaBonus"
        (ngModelChange)="onInputChange()"
        min="0"
        step="0.5"
      />
    </div>
  </div>

  <div
    class="recommendation-section"
    [ngClass]="{
      omega: recommendation.includes('√îMEGA'),
      alfa: recommendation.includes('ALFA'),
      empate: recommendation.includes('EMPATE')
    }"
  >
    <div class="icon-frame" *ngIf="recommendation.includes('ALFA')">
      <img
        src="assets/images/Proficiency_Type_Alpha_Dmg.gif"
        alt="Alfa Strike Recomendado"
        class="recommendation-icon"
      />
    </div>
    <div class="icon-frame" *ngIf="recommendation.includes('√îMEGA')">
      <img
        src="assets/images/Proficiency_Type_Omega_Dmg.gif"
        alt="√îmega Strike Recomendado"
        class="recommendation-icon"
      />
    </div>
    <div class="recommendation-content">
      <h3>Recomenda√ß√£o:</h3>
      <p class="recommendation-text">{{ recommendation }}</p>
    </div>
  </div>

  <div class="details-section">
    <div class="result-card alfa-card">
      <div class="card-header">
        <div class="icon-frame">
          <img
            src="assets/images/Proficiency_Type_Alpha_Dmg.gif"
            alt="Alfa Strike"
            class="card-icon"
          />
        </div>
        <h4>Alfa Strike ({{ alfaBonus }}% quando HP > 95%)</h4>
      </div>
      <div class="stats" *ngIf="alfaResult">
        <p>
          <strong>Dano Total:</strong> {{ alfaResult.totalDamage.toFixed(0) }}
        </p>
        <p>
          <strong>Dano com B√¥nus:</strong>
          {{ alfaResult.bonusDamage.toFixed(0) }}
        </p>
      </div>
    </div>

    <div class="result-card omega-card">
      <div class="card-header">
        <div class="icon-frame">
          <img
            src="assets/images/Proficiency_Type_Omega_Dmg.gif"
            alt="√îmega Strike"
            class="card-icon"
          />
        </div>
        <h4>√îmega Strike ({{ omegaBonus }}% quando HP < 30%)</h4>
      </div>
      <div class="stats" *ngIf="omegaResult">
        <p>
          <strong>Dano Total:</strong> {{ omegaResult.totalDamage.toFixed(0) }}
        </p>
        <p>
          <strong>Dano com B√¥nus:</strong>
          {{ omegaResult.bonusDamage.toFixed(0) }}
        </p>
      </div>
    </div>
  </div>

  <!-- Scenarios Section -->
  <div class="scenarios-section">
    <button class="toggle-scenarios-btn" (click)="toggleScenarios()">
      {{ showScenarios ? "‚ñº" : "‚ñ∂" }} üéØ An√°lise Comparativa: Alfa vs √îmega
    </button>

    <div class="scenarios-content" *ngIf="showScenarios">
      <div class="scenarios-card">
        <h4>üìä COMPARA√á√ÉO DE DANO EXTRA (APENAS O B√îNUS)</h4>
        <p class="info-note">
          üí° <strong>Como funciona:</strong> Aqui comparamos apenas o
          <strong>dano EXTRA</strong> que cada proficiency proporciona. Por
          exemplo, se seu dano m√©dio √© 400: Alfa adiciona
          <strong>64 de dano extra</strong> (16% de 400), mas √îmega pode
          adicionar <strong>muito mais</strong> porque ativa em v√°rios hits no
          final da luta!
        </p>

        <!-- Scenario 1 -->
        <div class="scenario-group">
          <h5>1. MONSTROS COM HP BAIXO (2.500 - 4.000) | Dano: 400</h5>
          <div class="scenario-table">
            <div class="table-header">
              <span>HP</span>
              <span>Dano Base</span>
              <span>Alfa Extra</span>
              <span>√îmega Extra</span>
              <span>Melhor</span>
            </div>
            <div class="table-row alfa-winner">
              <span>2.500</span>
              <span>400</span>
              <span>64</span>
              <span>52</span>
              <span class="highlight-alfa">ALFA</span>
            </div>
            <div class="table-row alfa-winner">
              <span>3.000</span>
              <span>400</span>
              <span>64</span>
              <span>52</span>
              <span class="highlight-alfa">ALFA</span>
            </div>
            <div class="table-row alfa-winner">
              <span>3.500</span>
              <span>400</span>
              <span>64</span>
              <span>52</span>
              <span class="highlight-alfa">ALFA</span>
            </div>
            <div class="table-row alfa-winner">
              <span>4.000</span>
              <span>400</span>
              <span>64</span>
              <span>52</span>
              <span class="highlight-alfa">ALFA</span>
            </div>
          </div>
        </div>

        <!-- Scenario 2 -->
        <div class="scenario-group">
          <h5>2. HP MODERADO (5.000) - VARIA√á√ÉO DE DANO</h5>
          <div class="scenario-table">
            <div class="table-header">
              <span>Dano Base</span>
              <span>Alfa Extra</span>
              <span>√îmega Extra</span>
              <span>Diferen√ßa</span>
              <span>Melhor</span>
            </div>
            <div class="table-row omega-winner">
              <span>300</span>
              <span>48</span>
              <span>98</span>
              <span>+104%</span>
              <span class="highlight-omega">√îMEGA</span>
            </div>
            <div class="table-row omega-winner">
              <span>400</span>
              <span>64</span>
              <span>104</span>
              <span>+63%</span>
              <span class="highlight-omega">√îMEGA</span>
            </div>
            <div class="table-row alfa-winner">
              <span>500</span>
              <span>80</span>
              <span>65</span>
              <span>-19%</span>
              <span class="highlight-alfa">ALFA</span>
            </div>
            <div class="table-row omega-winner">
              <span>600</span>
              <span>96</span>
              <span>117</span>
              <span>+22%</span>
              <span class="highlight-omega">√îMEGA</span>
            </div>
            <div class="table-row alfa-winner">
              <span>700</span>
              <span>112</span>
              <span>91</span>
              <span>-19%</span>
              <span class="highlight-alfa">ALFA</span>
            </div>
            <div class="table-row alfa-winner">
              <span>800</span>
              <span>128</span>
              <span>104</span>
              <span>-19%</span>
              <span class="highlight-alfa">ALFA</span>
            </div>
          </div>
        </div>

        <!-- Scenario 3 -->
        <div class="scenario-group">
          <h5>3. HP ALTO (8.000) - DANO ALTO</h5>
          <div class="scenario-table">
            <div class="table-header">
              <span>Dano Base</span>
              <span>HP</span>
              <span>Alfa Extra</span>
              <span>√îmega Extra</span>
              <span>Melhor</span>
            </div>
            <div class="table-row alfa-winner">
              <span>800</span>
              <span>8.000</span>
              <span>128</span>
              <span>104</span>
              <span class="highlight-alfa">ALFA</span>
            </div>
            <div class="table-row alfa-winner">
              <span>1.000</span>
              <span>8.000</span>
              <span>160</span>
              <span>130</span>
              <span class="highlight-alfa">ALFA</span>
            </div>
          </div>
        </div>

        <!-- Scenario 4 -->
        <div class="scenario-group">
          <h5>4. HP MUITO ALTO (10.000) - VARIA√á√ÉO DE DANO</h5>
          <div class="scenario-table">
            <div class="table-header">
              <span>Dano Base</span>
              <span>Alfa Extra</span>
              <span>√îmega Extra</span>
              <span>Diferen√ßa</span>
              <span>Melhor</span>
            </div>
            <div class="table-row omega-winner">
              <span>300</span>
              <span>96</span>
              <span>176</span>
              <span>+83%</span>
              <span class="highlight-omega">√îMEGA</span>
            </div>
            <div class="table-row omega-winner">
              <span>400</span>
              <span>128</span>
              <span>182</span>
              <span>+42%</span>
              <span class="highlight-omega">√îMEGA</span>
            </div>
            <div class="table-row omega-winner">
              <span>500</span>
              <span>80</span>
              <span>163</span>
              <span>+104%</span>
              <span class="highlight-omega">√îMEGA</span>
            </div>
            <div class="table-row omega-winner">
              <span>600</span>
              <span>96</span>
              <span>195</span>
              <span>+103%</span>
              <span class="highlight-omega">√îMEGA</span>
            </div>
            <div class="table-row omega-winner">
              <span>700</span>
              <span>112</span>
              <span>182</span>
              <span>+63%</span>
              <span class="highlight-omega">√îMEGA</span>
            </div>
            <div class="table-row omega-winner">
              <span>800</span>
              <span>128</span>
              <span>208</span>
              <span>+63%</span>
              <span class="highlight-omega">√îMEGA</span>
            </div>
          </div>
        </div>

        <!-- Conclusion Box -->
        <div class="conclusion-box">
          <h5>üéØ CONCLUS√ÉO DA AN√ÅLISE</h5>
          <div class="conclusion-content">
            <div class="analysis-text">
              <h6>‚öñÔ∏è Equilibro entre as Proficiencies</h6>
              <p>
                Com a an√°lise do <strong>dano EXTRA</strong> (n√£o o dano total),
                vemos que a competi√ß√£o √© muito mais equilibrada! Agora
                conseguimos ver claramente quando cada proficiency se destaca.
              </p>

              <div class="comparison-boxes">
                <div class="comparison-item alfa-item">
                  <strong>‚ö° ALFA STRIKE (16%)</strong>
                  <ul>
                    <li><strong>Melhor em:</strong> HP baixo (2.500-4.000)</li>
                    <li><strong>Melhor em:</strong> Dano alto (700-1.000)</li>
                    <li>Ativa quando HP > 95% (in√≠cio)</li>
                    <li>
                      ‚úÖ Dano extra constante:
                      <strong>16% do seu dano base</strong>
                    </li>
                    <li>
                      üìä Exemplo: Dano 800 = <strong>128 de b√¥nus</strong>
                    </li>
                  </ul>
                </div>

                <div class="comparison-item omega-item">
                  <strong>üéØ √îMEGA STRIKE (6.5%)</strong>
                  <ul>
                    <li><strong>Melhor em:</strong> HP alto (10.000+)</li>
                    <li>
                      <strong>Melhor em:</strong> Dano baixo/m√©dio (300-600)
                    </li>
                    <li>Ativa quando HP < 30% (final)</li>
                    <li>
                      ‚úÖ Acumula dano extra em <strong>v√°rios hits</strong>
                    </li>
                    <li>
                      üìä Exemplo: Dano 400 em HP 10k =
                      <strong>182 de b√¥nus</strong>
                    </li>
                  </ul>
                </div>
              </div>

              <div class="verdict-box">
                <h6>‚úÖ GUIA DE DECIS√ÉO</h6>

                <div class="decision-table">
                  <div class="decision-row">
                    <strong>üü¢ Use ALFA STRIKE quando:</strong>
                    <ul>
                      <li>
                        Monstros com HP entre <strong>2.500 - 8.000</strong>
                      </li>
                      <li>Seu dano m√©dio √© <strong>alto (700+)</strong></li>
                      <li>Battles r√°pidas (poucos hits)</li>
                      <li>
                        Quer garantir <strong>dano extra fixo</strong> sempre
                      </li>
                    </ul>
                  </div>

                  <div class="decision-row">
                    <strong>üî¥ Use √îMEGA STRIKE quando:</strong>
                    <ul>
                      <li>Monstros com HP <strong>10.000+</strong></li>
                      <li>
                        Seu dano m√©dio √© <strong>baixo/m√©dio (300-600)</strong>
                      </li>
                      <li>Battles longas (muitos hits)</li>
                      <li>
                        Quer maximizar dano total em
                        <strong>bosses/raids</strong>
                      </li>
                    </ul>
                  </div>
                </div>

                <p class="recommendation-final">
                  üí° <strong>Recomenda√ß√£o Geral:</strong> A escolha depende do
                  seu <strong>estilo de hunt</strong>! Alfa √© mais consistente e
                  previs√≠vel. √îmega tem potencial maior em fights longos. Use a
                  calculadora acima com seus valores reais para decidir!
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
